<html>
<head>
    <script type="text/javascript"
            src="https://www.airconsole.com/api/airconsole-latest.js"></script>
    <script type="text/javascript"
            src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript"
            src="airconsole-view-manager.js"></script>

    <style> 
       input[type=button] {
         position:absolute;
         transition: .5s ease;
        }
    </style>
</head>
<body>

<script type="text/javascript" src="https://www.airconsole.com/api/airconsole-1.6.0.js"></script>
<script type="text/javascript" src="airconsole-view-manager.js"></script>

    <div id="combat" class="view">
    </div>


    <div id="start_combat" class="view">
        <input type="button" id="1" onclick="press(this.id)" value="1">
        <input type="button" id="2" onclick="press(this.id)" value="2">
        <input type="button" id="3" onclick="press(this.id)" value="3">
    </div>

    <div id="combat_result_won" class="view">
         YOU WON 
        
    </div>

    <div id="combat_result_lost" class="view">
       
       YOU LOST
    </div>

        <script>
            var air_console = new AirConsole();
            var vm;

            air_console.onReady = function () {
                vm = new AirConsoleViewManager(air_console);
            }

            //determines the number of buttons present
            var num_buttons = 3;

            //the button with this value should be clicked first
            var start_button = 1;

            //number of parameters for position (left and top)
            var param = 2;

            //create 2D array to store previous positions in
            var param_arr = new Array(num_buttons);
            for (var i = 0; i < num_buttons; i++) {
                param_arr[i] = new Array(param);
            }

            var index = -1;

            //sets a button in a random position
            function randomPosition(id) {
                index++;
                var d = document.getElementById(id);
                assignRandom(d, index);
            }


            function assignRandom(d, index) {
                var left = getRandomArbitrary(10, 90);
                var top = getRandomArbitrary(10, 90);
                d.style.left = left + '%';
                d.style.top = top + '%';
                var button_width = (d.offsetWidth / window.innerWidth) * 100;
                var button_height = (d.offsetHeight / window.innerHeight) * 100;
                if (index > 0) {
                    if (!checkBoundaries(param_arr, left, left + button_width, top, top + button_height)) {
                        assignRandom(d, index);
                    }
                    else {
                        param_arr[index] = [left, top];
                    }
                }
                else {
                    param_arr[index] = [left, top];
                }
            }

            function checkBoundaries(arr, fromWidth, toWidth, fromHeight, toHeight) {
                //go through array
                for (var i = 0; i < arr.length; i++) {
                    if ((arr[i][0] >= fromWidth && arr[i][0] <= toWidth) && (arr[i][1]) >= fromHeight && arr[i][1] <= toHeight) {
                        return false;
                    }
                }
                return true;
            }

            //TODO optimize code
            randomPosition("3");
            randomPosition("2");
            randomPosition("1");

            function eraseButton(id) {
                var d = document.getElementById(id);
                d.style.display = "none";
            }

            // Returns a random number between min (inclusive) and max (exclusive)
            function getRandomArbitrary(min, max) {
                return Math.random() * (max - min) + min;
            }

            air_console.onMessage = function (from, data) {
                console.log(data.action);
                if (data.action == "Won") {
                    //TODO access another HTML page
                    //document.location = "file://///C:/Users/Margo/Documents/CommandAndCupcakes-Unity/CommandAndCupcakes/Assets/AirConsoleControllerClientTest/won.html";
                    //location.replace("http://9gag.com/");
                    //document.location.href = "http://ekstrabladet.dk/";
                    //alert("You win");
                    vm.show('combat_result_won');

                }
                else if (data.action == "Lost") {
                    document.location.href = "http://www.yr.no/";
                    //alert("You loose");
                }

            };


            function send_message(action) {
                var message = {
                    'action': action
                };

                air_console.message(AirConsole.SCREEN, message);
            }



            function press(clicked_id) {
                eraseButton(clicked_id);

                if (clicked_id == start_button) {

                    if (num_buttons == start_button) {
                        send_message("win");
                    }

                    start_button++;
                }
                else {
                    send_message("loose");
                }
            }

        </script>

</body>
</html>